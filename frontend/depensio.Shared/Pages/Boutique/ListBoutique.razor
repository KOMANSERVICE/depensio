@page "/listboutique"
@using depensio.Shared.Pages.Boutique.Components
@using depensio.Shared.Pages.Boutique.Model
@inject NavigationManager _navigationManager
@inherits FlowbitePage
@layout SecondaryLayout
@inject IBoutiqueService _boutiqueService;
<PageTitle>Liste des boutiques</PageTitle>

        <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
           
            <div>
                <h2 class="text-3xl font-bold text-primary-700 text-gray-900 sm:text-2xl dark:text-white">Mes Entreprises</h2>
                <p class="text-gray-600">Gérez toutes ugvos entreprises en un seul endroit</p>
            </div>
         
            <button type="button" @onclick="onShowModal" id="addBusinessBtn" class="mt-4 md:mt-0 bg-primary-700 hover:bg-amber-800 text-white px-6 py-2 rounded-lg flex items-center space-x-2 transition">
                <i class="fas fa-plus"></i>
                <span>Nouvelle entreprise</span>
            </button>
        </div>


        <!-- Business List -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Business Card 1 -->      
        
            @foreach(var boutique in boutiques)
            {
                <CardBoutique Boutique="@boutique" />
            }

            <!-- Business Card 3 (Add new) -->
            <div @onclick="onShowModal" class="border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center p-8 cursor-pointer hover:border-primary-700 hover:bg-amber-50 transition">
                <div class="w-14 h-14 rounded-full bg-primary-700 bg-opacity-10 flex items-center justify-center mb-4">
                    <i class="fas fa-plus text-primary-700 text-2xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-700">Ajouter une entreprise</h3>
                <p class="text-sm text-gray-500 mt-1 text-center">Créez une nouvelle entreprise pour commencer à gérer vos activités</p>
            </div>
        </div>
    </div>

    <Modal     
        OnCloseModal="()=>{
           onShowModal();
    }"
    ShowModal="showModal"   
    ModalTitle="Nouvelle entreprise"
>
     <CreateBoutiqueComponent 
     OnAfterSave="async ()=>{
        await GetBoutiquesAsync();
        onShowModal();

    }" 
    OnCancelSave="()=>{
        onShowModal();
    }"
    />
</Modal>

@code {

    private List<BoutiqueDTO> boutiques = new();
    private bool showModal = false;


    protected override async Task OnInitializedAsync()
    {

        await GetBoutiquesAsync();
        // if(boutiques != null || boutiques.Data != null || boutiques.Data.Boutiques.Any())
        // {
        //     _navigationManager.NavigateTo($"/dashboard/{boutiques.Data.Boutiques.First().Id}", true);
        // }

    }

    private async Task GetBoutiquesAsync()
    {
         var result = await _boutiqueService.GetBoutiqueByUser();
        boutiques = result.Data.Boutiques.ToList();
    }

    
    private void onShowModal()
    {
        showModal = !showModal;
    }

}