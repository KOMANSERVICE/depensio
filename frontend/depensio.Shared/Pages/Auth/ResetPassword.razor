@page "/reset-password/{userId}"
@inject IAuthHttpService _auth

@code {
    [Parameter]
    public string? userId { get; set; }

    [SupplyParameterFromQuery]
    public string? Code { get; set; }

    private bool isLoad = false;
    private bool isSuccess = false;

    private VerifyMailDTO? verifyMail { get; set; }

    protected override void OnInitialized()
    {
        isLoad = true;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await ResetPass();
            StateHasChanged(); // Demander un nouveau rendu pour mettre à jour l'UI
        }
    }

    private string message = "";

    private async Task ResetPass()
    {
        try
        {
            verifyMail = new VerifyMailDTO(userId!, Code!.Replace(" ", "+"));
            var isVerify = await _auth.VerifyMail(new Models.VerifyMailRequest(verifyMail));
            if (isVerify.Result)
            {
                isSuccess = true;
                message = "Verification success";
            }
        }
        catch (ApiException e)
        {
            message = "Verification fail";
        }
        finally
        {
            isLoad = false;
        }
    }
}
