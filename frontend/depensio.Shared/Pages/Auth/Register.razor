@page "/register"
@inject NavigationManager NavManager
@inject IAuthService _authService;
@layout SecondaryLayout

<div class="min-h-screen flex flex-col items-center justify-center bg-gray-50">
    <div class="mb-8">
        <!-- Logo SVG ou image -->
        <svg class="mx-auto h-12 w-12 text-indigo-500" fill="none" viewBox="0 0 48 48">
            <circle cx="24" cy="24" r="24" fill="currentColor" />
        </svg>
    </div>
    <div class="w-full max-w-md bg-white rounded-lg shadow-md p-8">
        <h2 class="text-2xl font-bold text-center mb-6">Sign in to your account</h2>
        <EditForm Model="@loginModel" OnValidSubmit="HandleLogin">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="mb-4">
                <label class="block text-gray-700 mb-1" for="email">Email address</label>
                <InputText @bind-Value="loginModel.Email" id="email" type="email" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <ErrorMessageComponent ErrorValue="@errorMessage.GetErrorMessage("signup.email")" />
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 mb-1" for="lastname">Nom</label>
                <InputText @bind-Value="loginModel.LastName" id="lastName" type="text" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <ErrorMessageComponent ErrorValue="@errorMessage.GetErrorMessage("signup.lastname")" />
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 mb-1" for="fistName">Prénom</label>
                <InputText @bind-Value="loginModel.FirstName" id="firstName" type="text" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <ErrorMessageComponent ErrorValue="@errorMessage.GetErrorMessage("signup.firstName")" />
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 mb-1" for="tel">Téléphone</label>
                <InputText @bind-Value="loginModel.Tel" id="tel" type="text" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <ErrorMessageComponent ErrorValue="@errorMessage.GetErrorMessage("signup.tel")" />
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 mb-1" for="password">Password</label>
                <InputText @bind-Value="loginModel.Password" id="password" type="password" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <ErrorMessageComponent ErrorValue="@errorMessage.GetErrorMessage("signup.password")" />
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 mb-1" for="confirmPasswords">Password confirme</label>
                <InputText @bind-Value="loginModel.ConfirmPasswords" id="confirmPasswords" type="password" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <ErrorMessageComponent ErrorValue="@errorMessage.GetErrorMessage("signup.confirmPasswords")" />
            </div>
            <div class="flex items-center justify-between mb-6">
                <label class="flex items-center">
                    <input type="checkbox" class="form-checkbox" />
                    <span class="ml-2 text-gray-600">Remember me</span>
                </label>
                <a href="#" class="text-indigo-600 hover:underline text-sm">Forgot password?</a>
                <a href="#" class="text-indigo-600 hover:underline text-sm">Forgot password?</a>
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded font-semibold hover:bg-indigo-700 transition">Sign in</button>
        </EditForm>
        <div class="flex items-center my-6">
            <div class="flex-grow border-t"></div>
            <span class="mx-4 text-gray-400">Or continue with</span>
            <div class="flex-grow border-t"></div>
        </div>
        <div class="flex space-x-4">
            <button class="flex-1 flex items-center justify-center border rounded py-2 hover:bg-gray-50">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" class="h-5 w-5 mr-2" />
                Google
            </button>
            <button class="flex-1 flex items-center justify-center border rounded py-2 hover:bg-gray-50">
                <img src="https://www.svgrepo.com/show/512317/github-142.svg" alt="GitHub" class="h-5 w-5 mr-2" />
                GitHub
            </button>
        </div>
    </div>
    <div class="mt-6 text-gray-500">
        Not a member?
        <a href="#" class="text-indigo-600 font-semibold hover:underline">Start a 14 day free trial</a>
    </div>
</div>

@code {
    private SignUpDTO loginModel = new();
    private ErrorMessage errorMessage = new();
    private Dictionary<string, string> fieldErrors = new();

    private async Task HandleLogin()
    {
        fieldErrors.Clear();
        try
        {
            var response = await _authService.SignUp(new SignUpRequest(loginModel));
            if (response.Result)
            {
                NavManager.NavigateTo("signupsuccess");
            }
        }
        catch (Refit.ApiException ex)
        {
            errorMessage = JsonSerializer.Deserialize<ErrorMessage>(ex.Content);
        }
    }

    // Modèle pour parser les erreurs de validation
    public class ValidationErrorResponse
    {
        public Dictionary<string, string[]> Errors { get; set; }
    }
}