@page "/forgot-password"
@inject NavigationManager NavManager
@inject IAuthHttpService _authService
@layout NoContentLayout


<PageTitleComponent Title="Mot de passe ooublier" />

<div class="min-h-screen flex items-center justify-center">

    <div class="w-full max-w-md mx-4">
        <div class="bg-white rounded-xl shadow-lg p-8 transition-all duration-200 transform hover:-translate-y-1 hover:shadow-xl">
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Mot de passe oublié?</h1>
                <p class="text-gray-600">Entrez votre email pour recevoir un lien de réinitialisation</p>
            </div>

            <EditForm EditContext="@editContext" OnValidSubmit="HandleForgotPassword">
                <DataAnnotationsValidator />
                <ErrorsSummary editContext="@editContext" />
                <div class="space-y-6">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i data-feather="mail" class="text-gray-400"></i>
                            </div>
                            <InputText type="email" id="email" @bind-Value="forgotassword.Email"
                                   class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-primary-700 focus:ring-1 focus:ring-primary-700 focus:outline-none transition-all duration-200"
                                   placeholder="votre@email.com" />
                        </div>
                    </div>
                    <button type="submit" class="w-full px-6 py-3 rounded-lg font-medium text-white bg-primary-700 hover:bg-[#a3722c] transition-all duration-200 transform hover:-translate-y-0.5 hover:shadow-md">
                        Envoyer le lien
                    </button>

                    <div class="text-center text-sm text-gray-600">
                        <NavLink href="/" class="text-primary-700 hover:text-[#a3722c] transition-colors duration-200">
                            <i data-feather="arrow-left" class="inline mr-1"></i>
                            Retour à la connexion
                        </NavLink>
                    </div>
                </div>

            </EditForm>
        </div>

        <div class="text-center mt-6 text-sm text-gray-500">
            <p>Vous n'avez pas de compte? <a href="index.html" class="text-primary-700 hover:text-[#a3722c] transition-colors duration-200">S'inscrire</a></p>
        </div>
    </div>
</div>


@code {
    private bool isLoad = false;

    ForgotPasswordDTO forgotassword = new();
    private ErrorMessage errorMessage = new();

    private EditContext editContext;
    private ValidationMessageStore messageStore;


    protected override void OnInitialized()
    {
        editContext = new EditContext(forgotassword);
        messageStore = new ValidationMessageStore(editContext);

        editContext.OnValidationRequested += (s, e) => messageStore.Clear();
        editContext.OnFieldChanged += (s, e) => messageStore.Clear(e.FieldIdentifier);
    }



    private string message = "";

    private async Task HandleForgotPassword()
    {
        isLoad = true;
        StateHasChanged();
        try
        {
            var resetPass = await _authService.ForgotPasswordAsync(new ForgotPasswordRequest(forgotassword));
            NavManager.NavigateTo("traitmentsuccess");
        }
        catch (ApiException ex)
        {
            NavManager.NavigateTo("traitmentsuccess");
        }
        finally
        {
            isLoad = false;
        }
    }
}
